{"version":3,"file":"index.js","sources":["../src/helpers.js","../src/reducers.js","../src/base-arrow-navigation.js","../src/arrow-navigation.js","../src/use-arrow-navigation.js","../src/use-arrow-navigation-with-focus-state.js"],"sourcesContent":["import { useEffect, useRef } from 'react'\n\nexport function useKey(key, handler) {\n    // Store the handler in a ref so we don't have to memoize it during usage\n    const savedHandler = useRef(null)\n    useEffect(() => {\n        savedHandler.current = handler\n    }, [handler])\n\n    useEffect(() => {\n        window.addEventListener('keydown', event => {\n            if (event.code === key && savedHandler.current) {\n                savedHandler.current(event)\n            }\n        })\n    }, [key])\n}\n\nfunction modulo(x, y) {\n    return ((x % y) + y) % y\n}\n\nfunction findBoundedXIndex(xIndex, yIndex, delta, matrix) {\n    const xLength = matrix[yIndex].length\n    let newXIndex = xIndex + delta\n\n    const iterations = Math.sign(delta) === -1 ? newXIndex + 1 : xLength - newXIndex\n    for (let i = 0; i < iterations; i++) {\n        if (matrix[yIndex][newXIndex]) {\n            return { xIndex: newXIndex, yIndex }\n        }\n\n        newXIndex = newXIndex + delta\n    }\n\n    return { xIndex, yIndex }\n}\n\nfunction findContinuousXIndex(xIndex, yIndex, delta, matrix) {\n    const deltaIsNegative = Math.sign(delta) === -1\n    const yLength = matrix.length\n    let newYIndex = yIndex\n\n    for (let i = 0; i < yLength + 1; i++) {\n        if (!matrix[newYIndex]) continue\n\n        const xLength = matrix[newYIndex].length\n        let newXIndex = i === 0 ? xIndex + delta : deltaIsNegative ? xLength - 1 : 0\n\n        for (let j = 0; j < xLength; j++) {\n            if (matrix[newYIndex][newXIndex]) {\n                return { xIndex: newXIndex, yIndex: newYIndex }\n            }\n\n            if (\n                (newXIndex >= xLength - 1 && !deltaIsNegative) ||\n                (newXIndex === 0 && deltaIsNegative)\n            ) {\n                break\n            }\n            newXIndex = newXIndex + delta\n        }\n\n        newYIndex = modulo(newYIndex + delta, yLength)\n    }\n\n    return { xIndex, yIndex }\n}\n\nfunction findRoundTheWorldXIndex(xIndex, yIndex, delta, matrix) {\n    const xLength = matrix[yIndex].length\n    let newXIndex = modulo(xIndex + delta, xLength)\n\n    for (let i = 0; i < xLength - 1; i++) {\n        if (matrix[yIndex][newXIndex]) {\n            return { xIndex: newXIndex, yIndex }\n        }\n\n        newXIndex = modulo(newXIndex + delta, xLength)\n    }\n\n    return { xIndex, yIndex }\n}\nexport function findNextXIndex(xIndex, yIndex, delta, matrix, mode) {\n    switch (mode) {\n        case 'bounded':\n            return findBoundedXIndex(xIndex, yIndex, delta, matrix)\n        case 'continuous':\n            return findContinuousXIndex(xIndex, yIndex, delta, matrix)\n        default:\n            return findRoundTheWorldXIndex(xIndex, yIndex, delta, matrix)\n    }\n}\n\nfunction findBoundedYIndex(xIndex, yIndex, delta, matrix) {\n    const yLength = matrix.length\n    let newYIndex = yIndex + delta\n\n    const iterations = Math.sign(delta) === -1 ? newYIndex + 1 : yLength - newYIndex\n    for (let i = 0; i < iterations; i++) {\n        if (matrix[newYIndex] && matrix[newYIndex][xIndex]) {\n            return { xIndex, yIndex: newYIndex }\n        }\n\n        newYIndex = newYIndex + delta\n    }\n\n    return { xIndex, yIndex }\n}\n\nfunction getMaxXLength(matrix) {\n    let xLength = 0\n    matrix.forEach(xArray => {\n        if (xArray && xArray.length > xLength) {\n            xLength = xArray.length\n        }\n    })\n\n    return xLength\n}\n\nfunction findContinuousYIndex(xIndex, yIndex, delta, matrix) {\n    const deltaIsNegative = Math.sign(delta) === -1\n    const xLength = getMaxXLength(matrix)\n    const yLength = matrix.length\n    let newXIndex = xIndex\n\n    for (let i = 0; i < xLength + 1; i++) {\n        let newYIndex = i === 0 ? yIndex + delta : deltaIsNegative ? yLength - 1 : 0\n\n        for (let j = 0; j < yLength; j++) {\n            if (matrix[newYIndex] && matrix[newYIndex][newXIndex]) {\n                return { xIndex: newXIndex, yIndex: newYIndex }\n            }\n\n            if (\n                (newYIndex >= yLength - 1 && !deltaIsNegative) ||\n                (newYIndex === 0 && deltaIsNegative)\n            ) {\n                break\n            }\n            newYIndex = newYIndex + delta\n        }\n\n        newXIndex = modulo(newXIndex + delta, xLength)\n    }\n\n    return { xIndex, yIndex }\n}\nfunction findRoundTheWorldYIndex(xIndex, yIndex, delta, matrix) {\n    const yLength = matrix.length\n    let newYIndex = modulo(yIndex + delta, yLength)\n\n    for (let i = 0; i < yLength - 1; i++) {\n        if (matrix[newYIndex] && matrix[newYIndex][xIndex]) {\n            return { xIndex, yIndex: newYIndex }\n        }\n\n        newYIndex = modulo(newYIndex + delta, yLength)\n    }\n\n    return { xIndex, yIndex }\n}\n\nexport function findNextYIndex(xIndex, yIndex, delta, matrix, mode) {\n    switch (mode) {\n        case 'bounded':\n            return findBoundedYIndex(xIndex, yIndex, delta, matrix)\n        case 'continuous':\n            return findContinuousYIndex(xIndex, yIndex, delta, matrix)\n        default:\n            return findRoundTheWorldYIndex(xIndex, yIndex, delta, matrix)\n    }\n}\n","import { findNextXIndex, findNextYIndex } from './helpers'\n\nexport function baseArrowNavigationreducer(state, { type, payload }) {\n    const { xIndex, yIndex, initialXIndex, initialYIndex, matrix, mode } = state\n    function initializeSelectedIndex(xDelta, yDelta) {\n        if (!matrix.length) {\n            return state\n        }\n\n        if (xDelta === 1 || yDelta === 1) {\n            if (matrix[0] && matrix[0][0]) {\n                return {\n                    ...state,\n                    xIndex: 0,\n                    yIndex: 0,\n                }\n            }\n\n            return xDelta === 1\n                ? {\n                      ...state,\n                      ...findNextXIndex(0, 0, 1, matrix, 'continuous'),\n                  }\n                : {\n                      ...state,\n                      ...findNextYIndex(0, 0, 1, matrix, 'continuous'),\n                  }\n        }\n\n        if (xDelta === -1) {\n            return matrix[0]\n                ? { ...state, xIndex: matrix[0].length - 1, yIndex: 0 }\n                : {\n                      ...state,\n                      ...findNextXIndex(0, 0, -1, 'continuous'),\n                  }\n        }\n\n        if (yDelta === -1) {\n            return matrix[matrix.length - 1][0]\n                ? { ...state, xIndex: 0, yIndex: matrix.length - 1 }\n                : {\n                      ...state,\n                      ...findNextYIndex(0, matrix.length - 1, -1, 'continuous'),\n                  }\n        }\n    }\n\n    switch (type) {\n        case 'registerChild': {\n            const { x, y } = payload\n            if (!matrix[y]) matrix[y] = []\n            matrix[y][x] = true\n\n            return { ...state, matrix }\n        }\n        case 'deRegisterChild': {\n            const { x, y } = payload\n\n            // Remove the child from the matrix\n            const row = matrix[y]\n            delete row[x]\n            // If we removed a child that was at the end of the row, remove all empty elements\n            // up to the next child\n            const newRow = [...row.slice(0, row.lastIndexOf(true) + 1)]\n            newRow.length ? (matrix[y] = newRow) : delete matrix[y]\n\n            // Reset the current index if it pointed to this child\n            const indicies = x === xIndex &&\n                y === yIndex && { xIndex: initialXIndex, yIndex: initialYIndex }\n\n            return { ...state, ...indicies, matrix }\n        }\n        case 'updateXIndex':\n            return xIndex === undefined && yIndex === undefined\n                ? initializeSelectedIndex(payload.delta, undefined)\n                : {\n                      ...state,\n                      ...findNextXIndex(xIndex, yIndex, payload.delta, matrix, mode),\n                  }\n        case 'updateYIndex':\n            return xIndex === undefined && yIndex === undefined\n                ? initializeSelectedIndex(undefined, payload.delta)\n                : {\n                      ...state,\n                      ...findNextYIndex(xIndex, yIndex, payload.delta, matrix, mode),\n                  }\n        case 'resetIndexes':\n            return { ...state, xIndex: initialXIndex, yIndex: initialYIndex }\n        case 'setIndexes': {\n            const { x, y } = payload\n            return { ...state, xIndex: x, yIndex: y }\n        }\n        default:\n            throw new Error(`Action type ${type} does not exist`)\n    }\n}\n\nexport function arrowNavigationReducer(state, { type, payload }) {\n    switch (type) {\n        case 'activate':\n            return { ...state, active: true }\n        case 'deactivate':\n            return {\n                ...state,\n                active: false,\n                childTabIndex: state.reInitOnDeactivate ? undefined : state.childTabIndex,\n            }\n        case 'setChildTabIndex': {\n            const { x, y } = payload\n            return { ...state, childTabIndex: { x, y } }\n        }\n        case 'unsetChildTabIndex': {\n            const { x, y } = payload\n            const { x: currentX, y: currentY } = state.childTabIndex || {}\n            return {\n                ...state,\n                childTabIndex: x === currentX && y === currentY ? undefined : state.childTabIndex,\n            }\n        }\n        default:\n            throw new Error(`Action type ${type} does not exist`)\n    }\n}\n","import React, { createContext, useReducer, useEffect } from 'react'\nimport { baseArrowNavigationreducer } from './reducers'\nimport { useKey } from './helpers'\n\nexport const BaseArrowNavigationContext = createContext({\n    xIndex: undefined,\n    yIndex: undefined,\n    registerChild: undefined,\n})\n\nfunction BaseArrowNavigation({\n    children,\n    initialIndex = [undefined, undefined],\n    mode = 'roundTheWorld',\n    active = true,\n    reInitOnDeactivate = false,\n}) {\n    const initialXIndex = initialIndex[0]\n    const initialYIndex = initialIndex[1]\n    const [{ xIndex, yIndex }, dispatch] = useReducer(baseArrowNavigationreducer, {\n        xIndex: initialXIndex,\n        yIndex: initialYIndex,\n        initialXIndex,\n        initialYIndex,\n        matrix: [],\n        mode,\n    })\n\n    useEffect(() => {\n        if (reInitOnDeactivate && !active) {\n            dispatch({ type: 'resetIndexes' })\n        }\n    }, [active, dispatch, reInitOnDeactivate, initialXIndex, initialYIndex])\n\n    useKey('ArrowLeft', () => active && dispatch({ type: 'updateXIndex', payload: { delta: -1 } }))\n    useKey('ArrowRight', () => active && dispatch({ type: 'updateXIndex', payload: { delta: 1 } }))\n    useKey('ArrowUp', () => active && dispatch({ type: 'updateYIndex', payload: { delta: -1 } }))\n    useKey('ArrowDown', () => active && dispatch({ type: 'updateYIndex', payload: { delta: 1 } }))\n\n    const contextValue = { xIndex, yIndex, active, dispatch }\n    return (\n        <BaseArrowNavigationContext.Provider value={contextValue}>\n            {children}\n        </BaseArrowNavigationContext.Provider>\n    )\n}\n\nexport default BaseArrowNavigation\n","import React, { createContext, useReducer, useRef } from 'react'\nimport BaseArrowNavigation from './base-arrow-navigation'\nimport { arrowNavigationReducer } from './reducers'\nimport { useKey } from './helpers'\n\nexport const ArrowNavigationContext = createContext({ dispatch: undefined })\n\nconst ArrowNavigation = React.forwardRef(\n    (\n        {\n            children,\n            initialIndex = [undefined, undefined],\n            mode = 'roundTheWorld',\n            reInitOnDeactivate = false,\n            ...divProps\n        },\n        providedRef\n    ) => {\n        const [{ active, childTabIndex }, dispatch] = useReducer(arrowNavigationReducer, {\n            active: false,\n            childTabIndex: undefined,\n            reInitOnDeactivate: reInitOnDeactivate,\n        })\n\n        const containerRef = useRef()\n        const ref = providedRef || containerRef\n\n        useKey('Escape', () => {\n            childTabIndex ? dispatch({ type: 'deactivate' }) : ref.current && ref.current.blur()\n        })\n\n        return (\n            <div\n                {...divProps}\n                tabIndex={childTabIndex ? undefined : 0}\n                ref={ref}\n                onFocus={() => dispatch({ type: 'activate' })}\n                onBlur={({ relatedTarget }) => {\n                    if (\n                        ref.current &&\n                        ((relatedTarget && !ref.current.contains(relatedTarget)) || !relatedTarget)\n                    ) {\n                        dispatch({ type: 'deactivate' })\n                    }\n                }}\n            >\n                <ArrowNavigationContext.Provider value={dispatch}>\n                    <BaseArrowNavigation\n                        active={active}\n                        initialIndex={initialIndex}\n                        mode={mode}\n                        reInitOnDeactivate={reInitOnDeactivate}\n                    >\n                        {children}\n                    </BaseArrowNavigation>\n                </ArrowNavigationContext.Provider>\n            </div>\n        )\n    }\n)\n\nexport default ArrowNavigation\n","import { useContext, useEffect, useCallback } from 'react'\nimport { BaseArrowNavigationContext } from './base-arrow-navigation'\n\nexport default function useArrowNavigation(x, y = 0) {\n    const { xIndex, yIndex, active, dispatch } = useContext(BaseArrowNavigationContext)\n\n    useEffect(() => {\n        dispatch({ type: 'registerChild', payload: { x, y } })\n\n        return () => {\n            dispatch({ type: 'deRegisterChild', payload: { x, y } })\n        }\n    }, [x, y, dispatch])\n\n    const selected = x === xIndex && y === yIndex\n    const memoizedSelect = useCallback(() => {\n        dispatch({ type: 'setIndexes', payload: { x, y } })\n    }, [dispatch, x, y])\n\n    return {\n        selected,\n        active,\n        select: memoizedSelect,\n    }\n}\n","import { useRef, useContext, useEffect } from 'react'\nimport useArrowNavigation from './use-arrow-navigation'\nimport { ArrowNavigationContext } from './arrow-navigation'\n\nexport default function useArrowNavigationWithFocusState(x, y) {\n    const { selected, active, select } = useArrowNavigation(x, y)\n    const dispatch = useContext(ArrowNavigationContext)\n    const ref = useRef()\n\n    useEffect(() => {\n        selected\n            ? dispatch({ type: 'setChildTabIndex', payload: { x, y } })\n            : dispatch({ type: 'unsetChildTabIndex', payload: { x, y } })\n\n        if (selected && active && document.activeElement !== ref.current) {\n            ref.current && ref.current.focus()\n        }\n\n        if (!(selected && active) && document.activeElement === ref.current) {\n            ref.current && ref.current.blur()\n        }\n\n        return () => {\n            dispatch({ type: 'unsetChildTabIndex', payload: { x, y } })\n        }\n    }, [x, y, selected, active, dispatch])\n\n    const focusProps = {\n        ref,\n        tabIndex: selected ? 0 : -1,\n        onClick: select,\n    }\n    return { selected, active, focusProps }\n}\n"],"names":["useKey","key","handler","savedHandler","useRef","current","addEventListener","event","code","modulo","x","y","findBoundedXIndex","xIndex","yIndex","delta","matrix","xLength","length","newXIndex","iterations","Math","sign","i","findContinuousXIndex","deltaIsNegative","yLength","newYIndex","j","findRoundTheWorldXIndex","findNextXIndex","mode","findBoundedYIndex","getMaxXLength","forEach","xArray","findContinuousYIndex","findRoundTheWorldYIndex","findNextYIndex","baseArrowNavigationreducer","state","type","payload","initialXIndex","initialYIndex","initializeSelectedIndex","xDelta","yDelta","row","newRow","slice","lastIndexOf","indicies","undefined","Error","arrowNavigationReducer","active","reInitOnDeactivate","childTabIndex","currentX","currentY","BaseArrowNavigationContext","createContext","BaseArrowNavigation","children","initialIndex","useReducer","dispatch","contextValue","React","ArrowNavigationContext","ArrowNavigation","forwardRef","providedRef","divProps","containerRef","ref","blur","relatedTarget","contains","useArrowNavigation","useContext","selected","memoizedSelect","useCallback","useArrowNavigationWithFocusState","select","document","activeElement","focus","focusProps"],"mappings":"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"}